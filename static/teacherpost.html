<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>发布公告</title>
  <script src="https://cdn.jsdelivr.net/npm/vue@2.7.14/dist/vue.js"></script>
  <script src="https://cdn.tailwindcss.com"></script>
  <link href="https://cdn.jsdelivr.net/npm/font-awesome@4.7.0/css/font-awesome.min.css" rel="stylesheet">
  <style>
    :root {
      --primary: #3b82f6;
      --success: #10b981;
      --danger: #ef4444;
      --warning: #f59e0b;
      --bg: #fefefe; 
      --card: #ffffff;
      --text: #1e293b;
      --border: #e2e8f0;
    }
    body { 
      background-color: var(--bg); 
      font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
      min-height: 100vh;
      margin: 0;
      padding: 0;
    }
    .card { background: var(--card); border-radius: 12px; box-shadow: 0 4px 20px rgba(0,0,0,0.05); }
    .input-base { 
      width: 100%; 
      padding: 8px 12px; 
      border: 1px solid var(--border); 
      border-radius: 8px; 
      transition: all 0.3s;
      background-color: var(--card); 
    }
    .input-base:focus { 
      outline: none; 
      border-color: var(--primary); 
      box-shadow: 0 0 0 3px rgba(59, 130, 246, 0.1);
    }
    .btn { 
      padding: 8px 16px; 
      border-radius: 8px; 
      cursor: pointer; 
      transition: all 0.3s;
      display: inline-flex;
      align-items: center;
      gap: 6px;
      font-weight: 500;
    }
    .btn-primary { background: var(--primary); color: white; }
    .btn-primary:hover { background: #2563eb; transform: translateY(-1px); }
    .btn-outline { background: white; border: 1px solid var(--border); color: var(--text); }
    .btn-outline:hover { background: #f8fafc; }
    .badge { padding: 4px 8px; border-radius: 20px; font-size: 12px; font-weight: 500; }
    .table-row:hover { background: #f8fafc; }
    .glass { 
      backdrop-filter: blur(10px); 
      background: rgba(255, 255, 255, 0.9); 
      border-bottom: 1px solid rgba(226, 232, 240, 0.5);
    }
    .page-active { background: var(--primary); color: white; border-color: var(--primary); }
    .nav-btn {
      padding: 8px 16px;
      border-radius: 8px;
      cursor: pointer;
      transition: all 0.3s;
      display: inline-flex;
      align-items: center;
      gap: 6px;
      font-weight: 500;
      background: white;
      border: 1px solid var(--border);
      color: var(--text);
      text-decoration: none;
    }
    .nav-btn:hover {
      background: #f8fafc;
      transform: translateY(-1px);
    }
    .nav-btn.active {
      background: var(--primary);
      color: white;
      border-color: var(--primary);
    }
  </style>
</head>
<body class="text-gray-800">
  <header class="glass fixed top-0 left-0 right-0 z-30">
    <div class="flex items-center justify-between px-6 h-16">
      <div class="flex items-center gap-3">
        <i class="fa fa-graduation-cap text-blue-500 text-xl"></i>
        <h1 class="font-bold text-lg hidden sm:block text-blue-900">学生管理系统</h1>
      </div>
      <div class="flex items-center gap-2">
        <a href="teacherscore.html" class="nav-btn">
          <i class="fa fa-bar-chart"></i>
          <span class="hidden sm:inline">录入成绩</span>
        </a>
        <a href="teachertest.html" class="nav-btn">
          <i class="fa fa-file-text-o"></i>
          <span class="hidden sm:inline">创建考试</span>
        </a>
        <a href="#" class="nav-btn active">
          <i class="fa fa-bullhorn"></i>
          <span class="hidden sm:inline">发布公告</span>
        </a>
        <a href="teacher.html" class="nav-btn">
          <i class="fa fa-home"></i>
          <span class="hidden sm:inline">返回首页</span>
        </a>
      </div>
    </div>
  </header>

  <main class="pt-20 p-6 max-w-6xl mx-auto" id="app">
    <div class="mb-8">
      <h2 class="text-3xl font-bold text-blue-900 mb-2">发布公告</h2>
      <div class="flex items-center gap-2 text-gray-500 text-sm">
        <a href="teacher.html" class="hover:text-blue-500">教师主页</a>
        <i class="fa fa-angle-right"></i>
        <span>发布公告</span>
      </div>
    </div>

    <div class="card p-6 mb-6">
      <h3 class="font-bold text-lg mb-4">创建新公告</h3>
      <div class="grid grid-cols-1 gap-4">
        <div>
          <label class="block text-gray-600 font-medium mb-2 text-sm">公告标题 <span class="text-red-500">*</span></label>
          <input type="text" class="input-base" v-model="new_announcement.announcement_title" placeholder="请输入公告标题">
        </div>
        <div>
          <label class="block text-gray-600 font-medium mb-2 text-sm">公告内容 <span class="text-red-500">*</span></label>
          <textarea class="input-base h-32" v-model="new_announcement.announcement_content" placeholder="请输入公告内容"></textarea>
        </div>
        <div>
          <label class="block text-gray-600 font-medium mb-2 text-sm">发布对象 <span class="text-red-500">*</span></label>
          <select class="input-base" v-model="new_announcement.announcement_target">
            <option value="">请选择发布对象</option>
            <option value="all">全体学生</option>
            <option value="cs202301">计算机2301班</option>
            <option value="cs202302">计算机2302班</option>
            <option value="cs202303">计算机2303班</option>
            <option value="cs202304">计算机2304班</option>
          </select>
        </div>
        <div class="flex justify-end gap-3 mt-2">
          <button class="btn btn-outline" @click="resetForm">
            <i class="fa fa-refresh"></i>重置
          </button>
          <button class="btn btn-primary" @click="publishAnnouncement">
            <i class="fa fa-send"></i>发布公告
          </button>
        </div>
      </div>
    </div>

    <div class="card overflow-hidden">
      <div class="p-6 border-b border-gray-100">
        <h3 class="font-bold text-lg">公告列表 <span class="text-gray-400 font-normal text-sm">(共{{ total_count }}条公告)</span></h3>
      </div>

      <div class="overflow-x-auto">
        <table class="w-full">
          <thead class="bg-gray-50">
            <tr>
              <th class="px-4 py-3 text-left text-xs font-medium text-gray-500">序号</th>
              <th class="px-4 py-3 text-left text-xs font-medium text-gray-500">公告标题</th>
              <th class="px-4 py-3 text-left text-xs font-medium text-gray-500">发布对象</th>
              <th class="px-4 py-3 text-left text-xs font-medium text-gray-500">发布时间</th>
              <th class="px-4 py-3 text-left text-xs font-medium text-gray-500">操作</th>
            </tr>
          </thead>
          <tbody class="divide-y divide-gray-100">
            <tr class="table-row" v-for="(announcement, idx) in current_page_announcements" :key="announcement.announcement_id">
              <td class="px-4 py-3 text-sm">{{ (current_page - 1) * page_size + idx + 1 }}</td>
              <td class="px-4 py-3">
                <div class="font-medium">{{ announcement.announcement_title }}</div>
                <div class="text-xs text-gray-500 mt-1 line-clamp-2">{{ announcement.announcement_content }}</div>
              </td>
              <td class="px-4 py-3 text-sm">{{ announcement.announcement_target_text }}</td>
              <td class="px-4 py-3 text-sm">{{ announcement.announcement_time }}</td>
              <td class="px-4 py-3">
                <div class="flex gap-2">
                  <button class="text-blue-500 hover:text-blue-700 text-sm" @click="viewAnnouncement(announcement)">
                    <i class="fa fa-eye"></i> 查看
                  </button>
                  <button class="text-red-500 hover:text-red-700 text-sm" @click="deleteAnnouncement(announcement)">
                    <i class="fa fa-trash"></i> 删除
                  </button>
                </div>
              </td>
            </tr>
          </tbody>
        </table>
      </div>

      <div class="p-4 flex items-center justify-between text-sm text-gray-500">
        <span>显示 {{ (current_page - 1) * page_size + 1 }} 至 {{ Math.min(current_page * page_size, total_count) }} 条，共 {{ total_count }} 条</span>
        <div class="flex gap-1">
          <button class="px-3 py-1 rounded border border-gray-200 hover:bg-gray-50" @click="changePage('prev')" :disabled="current_page === 1">
            <i class="fa fa-angle-left"></i>
          </button>
          <button 
            class="px-3 py-1 rounded border border-gray-200 hover:bg-gray-50"
            v-for="page in total_pages"
            :key="page"
            @click="changePage(page)"
            :class="{ 'page-active': page === current_page }"
          >{{ page }}</button>
          <button class="px-3 py-1 rounded border border-gray-200 hover:bg-gray-50" @click="changePage('next')" :disabled="current_page === total_pages">
            <i class="fa fa-angle-right"></i>
          </button>
        </div>
      </div>
    </div>

    <!-- 公告详情模态框 -->
    <div class="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-40" v-if="show_modal">
      <div class="card max-w-2xl w-full mx-4">
        <div class="p-6 border-b border-gray-100 flex justify-between items-center">
          <h3 class="font-bold text-lg">公告详情</h3>
          <button class="text-gray-500 hover:text-gray-700" @click="show_modal = false">
            <i class="fa fa-times"></i>
          </button>
        </div>
        <div class="p-6">
          <div class="mb-4">
            <h4 class="text-lg font-medium text-blue-900 mb-2">{{ selected_announcement.announcement_title }}</h4>
            <div class="flex items-center gap-4 text-sm text-gray-500">
              <span>发布对象: {{ selected_announcement.announcement_target_text }}</span>
              <span>发布时间: {{ selected_announcement.announcement_time }}</span>
            </div>
          </div>
          <div class="bg-gray-50 p-4 rounded-lg">
            <p class="text-gray-700 whitespace-pre-line">{{ selected_announcement.announcement_content }}</p>
          </div>
        </div>
        <div class="p-6 border-t border-gray-100 flex justify-end">
          <button class="btn btn-outline" @click="show_modal = false">关闭</button>
        </div>
      </div>
    </div>
  </main>

  <script>
    new Vue({
      el: '#app',
      data() {
        return {
          new_announcement: {
            announcement_title: '',
            announcement_content: '',
            announcement_target: ''
          },
          announcements: [],
          current_page: 1,
          page_size: 5,
          total_count: 0,
          total_pages: 0,
          show_modal: false,
          selected_announcement: {},
          // 映射表
          target_map: {
            'all': '全体学生',
            'cs202301': '计算机2301班',
            'cs202302': '计算机2302班',
            'cs202303': '计算机2303班',
            'cs202304': '计算机2304班'
          }
        };
      },
      computed: {
        current_page_announcements() {
          const start_index = (this.current_page - 1) * this.page_size;
          const end_index = start_index + this.page_size;
          return this.announcements.slice(start_index, end_index);
        }
      },
      methods: {
        publishAnnouncement() {
          // 验证表单
          if (!this.new_announcement.announcement_title.trim()) {
            alert('请输入公告标题');
            return;
          }
          if (!this.new_announcement.announcement_content.trim()) {
            alert('请输入公告内容');
            return;
          }
          if (!this.new_announcement.announcement_target) {
            alert('请选择发布对象');
            return;
          }

          // 创建新公告
          const new_announcement = {
            announcement_id: Date.now(),
            announcement_title: this.new_announcement.announcement_title,
            announcement_content: this.new_announcement.announcement_content,
            announcement_target: this.new_announcement.announcement_target,
            announcement_target_text: this.target_map[this.new_announcement.announcement_target],
            announcement_time: new Date().toLocaleString('zh-CN')
          };

          // 添加到公告列表
          this.announcements.unshift(new_announcement);
          
          // 更新分页信息
          this.total_count = this.announcements.length;
          this.total_pages = Math.ceil(this.total_count / this.page_size);
          
          // 重置表单
          this.resetForm();
          
          alert('公告发布成功！');
        },
        resetForm() {
          this.new_announcement = {
            announcement_title: '',
            announcement_content: '',
            announcement_target: ''
          };
        },
        viewAnnouncement(announcement) {
          this.selected_announcement = announcement;
          this.show_modal = true;
        },
        deleteAnnouncement(announcement) {
          if (confirm(`确定要删除公告"${announcement.announcement_title}"吗？`)) {
            const index = this.announcements.findIndex(a => a.announcement_id === announcement.announcement_id);
            if (index !== -1) {
              this.announcements.splice(index, 1);
              this.total_count = this.announcements.length;
              this.total_pages = Math.ceil(this.total_count / this.page_size);
              
              // 如果当前页没有内容且不是第一页，则跳转到前一页
              if (this.current_page > this.total_pages && this.current_page > 1) {
                this.current_page = this.total_pages;
              }
              
              alert('公告删除成功！');
            }
          }
        },
        changePage(target) {
          let new_page = this.current_page;
          if (target === 'prev') new_page--;
          if (target === 'next') new_page++;
          if (typeof target === 'number') new_page = target;

          if (new_page < 1 || new_page > this.total_pages) return;
          this.current_page = new_page;
        }
      },
      mounted() {
        // 初始化一些示例数据
        this.announcements = [
          {
            announcement_id: 1,
            announcement_title: '关于期末考试安排的通知',
            announcement_content: '各位同学请注意，期末考试将于下周一至周三进行，请各位同学提前做好准备。具体考试时间和地点请查看教务处网站。',
            announcement_target: 'all',
            announcement_target_text: '全体学生',
            announcement_time: '2023-06-10 09:30:25'
          },
          {
            announcement_id: 2,
            announcement_title: '数据结构课程设计提交提醒',
            announcement_content: '计算机2301班和2302班的同学，数据结构课程设计报告请于本周五前提交至教务系统，逾期将影响成绩评定。',
            announcement_target: 'cs202301',
            announcement_target_text: '计算机2301班',
            announcement_time: '2023-06-08 14:15:33'
          },
          {
            announcement_id: 3,
            announcement_title: '图书馆开放时间调整',
            announcement_content: '因期末考试临近，图书馆将从下周起延长开放时间至晚上10点，请同学们合理安排复习时间。',
            announcement_target: 'all',
            announcement_target_text: '全体学生',
            announcement_time: '2023-06-05 16:45:12'
          }
        ];
        
        this.total_count = this.announcements.length;
        this.total_pages = Math.ceil(this.total_count / this.page_size);
      }
    });
  </script>
</body>
</html>
