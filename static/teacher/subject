<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>考试科目创建</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <link href="https://cdn.jsdelivr.net/npm/font-awesome@4.7.0/css/font-awesome.min.css" rel="stylesheet">
  <style>
    :root {
      --primary: #3b82f6;
      --success: #10b981;
      --danger: #ef4444;
      --card: #fff;
      --border: #e2e8f0;
    }
    body { background: #fefefe; font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif; min-height: 100vh; margin: 0; padding: 0; }
    .card { background: var(--card); border-radius: 12px; box-shadow: 0 4px 20px rgba(0,0,0,0.05); }
    .input-base { width: 100%; padding: 8px 12px; border: 1px solid var(--border); border-radius: 8px; transition: .3s; background: var(--card); }
    .input-base:focus { outline: none; border-color: var(--primary); box-shadow: 0 0 0 3px rgba(59,130,246,0.1); }
    .btn { padding: 8px 16px; border-radius: 8px; cursor: pointer; transition: .3s; display: inline-flex; align-items: center; gap: 6px; font-weight: 500; }
    .btn-primary { background: var(--primary); color: #fff; }
    .btn-primary:hover { background: #2563eb; transform: translateY(-1px); }
    .btn-success { background: var(--success); color: #fff; }
    .btn-success:hover { background: #059669; transform: translateY(-1px); }
    .btn-danger { background: var(--danger); color: #fff; }
    .btn-danger:hover { background: #dc2626; transform: translateY(-1px); }
    .btn-outline { background: #fff; border: 1px solid var(--border); color: #1e293b; }
    .btn-outline:hover { background: #f8fafc; }
    .badge { padding: 4px 8px; border-radius: 20px; font-size: 12px; font-weight: 500; display: inline-flex; align-items: center; gap: 4px; }
    .table-row:hover { background: #f8fafc; }
    .glass { backdrop-filter: blur(10px); background: rgba(255,255,255,0.9); border-bottom: 1px solid rgba(226,232,240,0.5); }
  </style>
</head>
<body class="text-gray-800">
  <header class="glass fixed top-0 left-0 right-0 z-30">
    <div class="flex items-center justify-between px-6 h-16">
      <div class="flex items-center gap-3">
        <i class="fa fa-book text-blue-500 text-xl"></i>
        <h1 class="font-bold text-lg hidden sm:block text-blue-900">考试管理系统</h1>
      </div>
      <button class="btn btn-outline"><i class="fa fa-home"></i><span class="hidden sm:inline">返回</span></button>
    </div>
  </header>

  <main class="pt-20 p-6 max-w-6xl mx-auto">
    <div class="mb-8">
      <h2 class="text-3xl font-bold text-blue-900 mb-2">创建考试科目</h2>
      <div class="flex items-center gap-2 text-gray-500 text-sm">
        <a href="#" class="hover:text-blue-500">教师主页</a>
        <i class="fa fa-angle-right"></i>
        <span>考试科目管理</span>
      </div>
    </div>

    <!-- 筛选与新增 -->
    <div class="card p-6 mb-6">
      <div class="grid grid-cols-1 md:grid-cols-3 gap-4 items-end">
        <div>
          <label class="block text-gray-600 font-medium mb-2 text-sm">科目名称</label>
          <input type="text" class="input-base" id="subjectName" placeholder="输入科目名称筛选">
        </div>
        <div>
          <label class="block text-gray-600 font-medium mb-2 text-sm">科目类型</label>
          <select class="input-base" id="subjectType">
            <option value="">全部类型</option>
            <option value="public">公共基础课</option>
            <option value="professional">专业必修课</option>
            <option value="elective">专业选修课</option>
          </select>
        </div>
        <div class="flex gap-3">
          <button class="btn btn-primary flex-1 justify-center" onclick="filterSubjects()"><i class="fa fa-filter"></i>筛选</button>
          <button class="btn btn-success flex-1 justify-center" onclick="openCreateModal()"><i class="fa fa-plus"></i>新增科目</button>
        </div>
      </div>
    </div>

    <!-- 科目列表 -->
    <div class="card overflow-hidden">
      <div class="p-6 border-b border-gray-100 flex flex-col sm:flex-row sm:items-center sm:justify-between gap-4">
        <h3 class="font-bold text-lg">考试科目列表 <span class="text-gray-400 font-normal text-sm">(共5条)</span></h3>

      </div>

      <div class="overflow-x-auto">
        <table class="w-full">
          <thead class="bg-gray-50">
            <tr>
              <th class="px-4 py-3 text-left text-xs font-medium text-gray-500">科目编码</th>
              <th class="px-4 py-3 text-left text-xs font-medium text-gray-500">科目名称</th>
              <th class="px-4 py-3 text-left text-xs font-medium text-gray-500">科目类型</th>
              <th class="px-4 py-3 text-left text-xs font-medium text-gray-500">学分</th>
              <th class="px-4 py-3 text-left text-xs font-medium text-gray-500">操作</th>
            </tr>
          </thead>
          <tbody class="divide-y divide-gray-100" id="subjectsTable"></tbody>
        </table>
      </div>

      <!-- 分页 -->
      <div class="p-4 flex items-center justify-between text-sm text-gray-500">
        <span>显示 1 至 5 条，共 5 条</span>
        <div class="flex gap-1">
          <button class="px-3 py-1 rounded border border-gray-200 hover:bg-gray-50" disabled><i class="fa fa-angle-left"></i></button>
          <button class="px-3 py-1 rounded border border-blue-500 bg-blue-500 text-white">1</button>
          <button class="px-3 py-1 rounded border border-gray-200 hover:bg-gray-50" disabled><i class="fa fa-angle-right"></i></button>
        </div>
      </div>
    </div>
  </main>

  <!-- 新增/编辑模态框 -->
  <div id="subjectModal" class="fixed inset-0 bg-black/50 hidden z-50 flex items-center justify-center p-4">
    <div class="bg-white rounded-lg max-w-md w-full p-6">
      <h3 class="text-lg font-bold mb-4" id="modalTitle">新增考试科目</h3>
      <div class="grid grid-cols-1 sm:grid-cols-2 gap-4 mb-4">
        <div class="sm:col-span-2">
          <label class="block text-gray-600 font-medium mb-2 text-sm">科目名称 <span class="text-red-500">*</span></label>
          <input type="text" class="input-base" id="modalSubName" placeholder="如：高等数学">
        </div>
        <div>
          <label class="block text-gray-600 font-medium mb-2 text-sm">科目编码 <span class="text-red-500">*</span></label>
          <input type="text" class="input-base" id="modalSubCode" placeholder="如：MATH101">
        </div>
        <div>
          <label class="block text-gray-600 font-medium mb-2 text-sm">科目类型 <span class="text-red-500">*</span></label>
          <select class="input-base" id="modalSubType">
            <option value="public">公共基础课</option>
            <option value="professional">专业必修课</option>
            <option value="elective">专业选修课</option>
          </select>
        </div>
        <div class="sm:col-span-2">
          <label class="block text-gray-600 font-medium mb-2 text-sm">学分 <span class="text-red-500">*</span></label>
          <input type="number" class="input-base" id="modalSubCredit" min="0.5" step="0.5" placeholder="如：3.0">
        </div>
      </div>
      <div class="flex gap-3 justify-end">
        <button class="btn btn-outline" onclick="closeModal()">取消</button>
        <button class="btn btn-primary" onclick="saveSubject()"><i class="fa fa-save"></i>保存</button>
      </div>
    </div>
  </div>

  <!-- 删除确认模态框 -->
  <div id="deleteModal" class="fixed inset-0 bg-black/50 hidden z-50 flex items-center justify-center p-4">
    <div class="bg-white rounded-lg max-w-md w-full p-6">
      <h3 class="text-lg font-bold mb-4 text-red-500">确认删除</h3>
      <p class="mb-6" id="deleteMsg">确定要删除该科目吗？删除后不可恢复！</p>
      <div class="flex gap-3 justify-end">
        <button class="btn btn-outline" onclick="closeDeleteModal()">取消</button>
        <button class="btn btn-danger" onclick="confirmDelete()"><i class="fa fa-trash"></i>确认删除</button>
      </div>
    </div>
  </div>

  <script>
    // 模拟数据：
    const examSubjects = [
      {subject_id: 1, subject_code: 'MATH101', subject_name: '高等数学', subject_type: 'public', subject_credit: 4.0},
      {subject_id: 2, subject_code: 'CS202', subject_name: '数据结构', subject_type: 'professional', subject_credit: 3.0},
      {subject_id: 3, subject_code: 'EN201', subject_name: '大学英语', subject_type: 'public', subject_credit: 3.0},
      {subject_id: 4, subject_code: 'PY301', subject_name: 'Python编程', subject_type: 'elective', subject_credit: 2.0},
      {subject_id: 5, subject_code: 'PHY101', subject_name: '大学物理', subject_type: 'public', subject_credit: 3.5}
    ];
    let currentSubId = null; // 存储当前操作的科目ID

    // 类型配置
    const typeConfig = {
      public: {text: '公共基础课', class: 'text-blue-700', icon: ''},
      professional: {text: '专业必修课', class: 'text-green-700', icon: ''},
      elective: {text: '专业选修课', class: 'text-purple-700', icon: ''}
    };

    // 渲染列表
    function renderSubjects(data = examSubjects) {
      const tableBody = document.getElementById('subjectsTable');
      // 更新列表计数
      document.querySelector('.font-bold.text-lg span').textContent = `(共${data.length}条)`;
      document.querySelector('.p-4.flex span').textContent = `显示 1 至 ${data.length} 条，共 ${data.length} 条`;
      
      tableBody.innerHTML = data.length 
        ? data.map(sub => `
            <tr class="table-row">
              <td class="px-4 py-3 text-sm font-medium">${sub.subject_code}</td>
              <td class="px-4 py-3 text-sm">${sub.subject_name}</td>
              <!-- 移除图标，仅保留文字和文字颜色 -->
              <td class="px-4 py-3"><span class="badge ${typeConfig[sub.subject_type].class}">${typeConfig[sub.subject_type].text}</span></td>
              <td class="px-4 py-3 text-sm">${sub.subject_credit}</td>
              <td class="px-4 py-3">
                <button class="btn btn-outline btn-sm mr-2" onclick="openEditModal(${sub.subject_id})"><i class="fa fa-edit"></i>编辑</button>
                <button class="btn btn-danger btn-sm" onclick="openDeleteModal(${sub.subject_id})"><i class="fa fa-trash"></i>删除</button>
              </td>
            </tr>
          `).join('')
        : `<tr><td colspan="5" class="px-4 py-8 text-center text-gray-500 text-sm"><i class="fa fa-info-circle mr-2"></i>未找到符合条件的科目</td></tr>`;
    }

    // 新增模态框
    function openCreateModal() {
      currentSubId = null;
      document.getElementById('modalTitle').textContent = '新增考试科目';
      document.getElementById('modalSubName').value = '';
      document.getElementById('modalSubCode').value = '';
      document.getElementById('modalSubType').value = 'public';
      document.getElementById('modalSubCredit').value = '';
      document.getElementById('subjectModal').classList.remove('hidden');
    }

    // 编辑模态框
    function openEditModal(subId) {
      const sub = examSubjects.find(item => item.subject_id === subId);
      if (!sub) return;
      currentSubId = subId;
      document.getElementById('modalTitle').textContent = '编辑考试科目';
      document.getElementById('modalSubName').value = sub.subject_name;
      document.getElementById('modalSubCode').value = sub.subject_code;
      document.getElementById('modalSubType').value = sub.subject_type;
      document.getElementById('modalSubCredit').value = sub.subject_credit;
      document.getElementById('subjectModal').classList.remove('hidden');
    }

    // 删除模态框
    function openDeleteModal(subId) {
      currentSubId = subId;
      const sub = examSubjects.find(item => item.subject_id === subId);
      document.getElementById('deleteMsg').textContent = `确定要删除科目「${sub.subject_name}」吗？删除后不可恢复！`;
      document.getElementById('deleteModal').classList.remove('hidden');
    }

    // 关闭模态框
    function closeModal() { document.getElementById('subjectModal').classList.add('hidden'); currentSubId = null; }
    function closeDeleteModal() { document.getElementById('deleteModal').classList.add('hidden'); currentSubId = null; }

        // 确认删除：删除后基于当前筛选条件重新渲染
    function confirmDelete() {
      const index = examSubjects.findIndex(sub => sub.subject_id === currentSubId);
      if (index !== -1) {
        examSubjects.splice(index, 1);
        // 关键修复：删除后重新执行筛选逻辑，保持筛选状态
        filterSubjects();
        closeDeleteModal();
        alert('科目删除成功！');
      }
    }

    // 保存科目：保存后基于当前筛选条件重新渲染
    function saveSubject() {
      const subData = {
        subject_name: document.getElementById('modalSubName').value.trim(),
        subject_code: document.getElementById('modalSubCode').value.trim(),
        subject_type: document.getElementById('modalSubType').value,
        subject_credit: parseFloat(document.getElementById('modalSubCredit').value) || 0
      };
      // 验证
      if (!subData.subject_name) return alert('请输入科目名称！');
      if (!subData.subject_code) return alert('请输入科目编码！');
      if (subData.subject_credit <= 0) return alert('学分必须大于0！');

      // 新增/编辑逻辑
      if (currentSubId === null) {
        examSubjects.push({
          ...subData,
          subject_id: Math.max(...examSubjects.map(sub => sub.subject_id), 0) + 1
        });
        alert('科目新增成功！');
      } else {
        const index = examSubjects.findIndex(sub => sub.subject_id === currentSubId);
        if (index !== -1) {
          examSubjects[index] = {...examSubjects[index], ...subData};
          alert('科目编辑成功！');
        }
      }

      // 关键修复：保存后重新执行筛选逻辑，保持筛选状态
      filterSubjects();
      closeModal();
    }

    // 筛选科目（字段对应数据库）
    function filterSubjects() {
      const filterName = document.getElementById('subjectName').value.trim().toLowerCase();
      const filterType = document.getElementById('subjectType').value;
      
      const filtered = examSubjects.filter(sub => {
        const matchName = filterName ? sub.subject_name.toLowerCase().includes(filterName) : true;
        const matchType = filterType ? sub.subject_type === filterType : true;
        return matchName && matchType;
      });
      
      renderSubjects(filtered);
    }

    // 初始化页面
    renderSubjects();
  </script>
</body>
</html>
